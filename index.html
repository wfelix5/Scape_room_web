<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Escape Room</title>

<style>
    /* FIX: Variable CSS para la altura real de la ventana en iOS (100vh fix) */
    :root {
        --app-height: 100vh;
    }

    body {
        margin: 0;
        padding: 20px;
        box-sizing: border-box; 
        
        min-height: 100vh; 
        min-height: var(--app-height); /* La altura dinámica y correcta para iOS */

        background: linear-gradient(135deg, #0a0f24, #1a2647);
        color: #e0e6ff;
        font-family: 'Segoe UI', sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        overflow: hidden; 
    }

    h1 {
        font-size: 2.5rem;
        text-align: center;
        text-shadow: 0 0 10px #5ca9ff;
        animation: fadeIn 1s ease-out forwards;
    }

    #main, #final, #incorrecto {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        animation: fadeIn 1s ease-out forwards;
    }

    input {
        margin-top: 20px;
        padding: 15px;
        font-size: 2rem;
        width: 90%; 
        max-width: 300px;
        box-sizing: border-box;
        border-radius: 12px;
        border: 2px solid #5ca9ff;
        background: rgba(255,255,255,0.1);
        color: #fff;
        text-align: center;
        letter-spacing: 8px;
        outline: none;
    }
    input::placeholder {
        color: #9bb3d1;
    }

    button {
        margin-top: 25px;
        padding: 15px 40px;
        font-size: 1.3rem;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        background: #5ca9ff;
        color: #0a0f24;
        font-weight: bold;
        transition: 0.3s;
        box-shadow: 0 0 15px #5ca9ff;
    }
    button:hover {
        background: #82c2ff;
        box-shadow: 0 0 25px #82c2ff;
    }

    #final { display: none; }
    #final h1 { font-size: 4rem; color: #7fffb2; text-shadow: 0 0 20px #1aff66, 0 0 40px #00cc52; animation: explode 0.8s ease-out forwards; }
    #incorrecto { display: none; }
    #incorrecto h1 { font-size: 2.5rem; color: #ff7f7f; text-shadow: 0 0 15px #ff4d4d; }
    #incorrecto p { font-size: 1.2rem; color: #e0e6ff; margin-top: 0; }
    #incorrecto button { background: #ff7f7f; box-shadow: 0 0 15px #ff7f7f; }
    #incorrecto button:hover { background: #ff9999; box-shadow: 0 0 25px #ff9999; }
    @keyframes fadeIn { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
    @keyframes explode { 0% { opacity: 0; transform: scale(0.2); } 60% { transform: scale(1.3); } 100% { transform: scale(1); opacity: 1; } }
    @media (max-width: 400px) { h1 { font-size: 2rem; } #final h1 { font-size: 2.8rem; } #incorrecto h1 { font-size: 1.8rem; } input { font-size: 1.5rem; letter-spacing: 4px; padding: 12px; } button { font-size: 1.1rem; padding: 12px 30px; } }
</style>
</head>

<body>

<div id="main">
    <h1>Escape Room</h1>
    <input id="codigo" maxlength="5" placeholder="CÓDIGO">
    <button id="validarBtn">VALIDAR</button>
</div>

<div id="final">
    <h1>¡HAS ESCAPADO!</h1>
    <button id="reiniciarBtn">REINICIAR</button>
</div>

<div id="incorrecto">
    <h1>CÓDIGO INCORRECTO</h1>
    <p>Vuelve a intentarlo.</p>
    <button id="reintentarBtn">REINTENTAR</button>
</div>


<script>
const codigoCorrecto = "70317";

// ** FIX: Función para calcular y aplicar la altura real en iOS **
const setAppHeight = () => {
    const vh = window.innerHeight;
    document.documentElement.style.setProperty('--app-height', `${vh}px`);
}
setAppHeight();
window.addEventListener('resize', setAppHeight);


// --- FUNCIONES DE LÓGICA ---
function verificar() {
    const val = document.getElementById("codigo").value;
    
    if (val === codigoCorrecto) {
        document.getElementById("main").style.display = "none";
        document.getElementById("incorrecto").style.display = "none";
        document.getElementById("final").style.display = "flex";
    } else {
        document.getElementById("main").style.display = "none";
        document.getElementById("incorrecto").style.display = "flex";
    }
}

function reiniciar() {
    document.getElementById("codigo").value = ""; 
    document.getElementById("final").style.display = "none";
    document.getElementById("main").style.display = "flex";
}

function reintentar() {
    document.getElementById("codigo").value = ""; 
    document.getElementById("incorrecto").style.display = "none";
    document.getElementById("main").style.display = "flex";
}

// ** FIX CLAVE para iOS: ASIGNACIÓN DE EVENTOS con Touchend y Click **

// Referencias a los botones
const validarBtn = document.getElementById("validarBtn");
const reiniciarBtn = document.getElementById("reiniciarBtn");
const reintentarBtn = document.getElementById("reintentarBtn");

// 1. Asignar 'click' (funciona en desktop y Android)
validarBtn.addEventListener('click', verificar);
reiniciarBtn.addEventListener('click', reiniciar);
reintentarBtn.addEventListener('click', reintentar);

// 2. Asignar 'touchend' (el más fiable en iOS)
validarBtn.addEventListener('touchend', (e) => {
    e.preventDefault();
    verificar();
});

reiniciarBtn.addEventListener('touchend', (e) => {
    e.preventDefault();
    reiniciar();
});

reintentarBtn.addEventListener('touchend', (e) => {
    e.preventDefault();
    reintentar();
});
</script>

</body>
</html>
