<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Escape Room</title>

<style>
    :root {
        --app-height: 100vh;
        --color-fondo: #0a0f24;
        --color-primario: #5ca9ff;
        --color-secundario: #e0e6ff;
        --color-exito: #00cc52;
        --color-error: #ff4d4d;
    }

    body {
        margin: 0;
        padding: 0;
        min-height: 100vh; 
        min-height: var(--app-height); 
        background: radial-gradient(circle at center, #1a2647 0%, var(--color-fondo) 100%);
        color: var(--color-secundario);
        font-family: 'Segoe UI', sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        overflow: hidden; 
        user-select: none; /* Evita que se seleccione texto al tocar rápido */
    }

    .container {
        padding: 20px; /* Reducido un poco para dar espacio al teclado */
        border-radius: 20px;
        background: rgba(26, 38, 71, 0.85);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 20px var(--color-primario);
        width: 90%;
        max-width: 400px; /* Un poco más estrecho para parecer un panel */
        text-align: center;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(92, 169, 255, 0.3);
    }

    h1 {
        font-size: 1.8rem;
        text-align: center;
        color: var(--color-primario);
        text-shadow: 0 0 8px var(--color-primario);
        margin: 0 0 15px 0;
    }
    
    p {
        font-size: 1rem;
        color: var(--color-secundario);
        opacity: 0.8;
        margin-bottom: 15px;
    }

    /* INPUT (Pantalla del código) */
    input {
        margin-bottom: 20px;
        padding: 15px;
        font-size: 2.5rem;
        width: 100%;
        box-sizing: border-box;
        border-radius: 8px;
        border: 2px solid var(--color-primario);
        background: #050814; /* Fondo muy oscuro para parecer pantalla LCD */
        color: #fff;
        text-align: center;
        letter-spacing: 12px;
        outline: none;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
        font-family: monospace; /* Fuente tipo código */
        pointer-events: none; /* Evita que salga el teclado del celular */
    }

    /* TECLADO NUMÉRICO (Grid) */
    .keypad {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* 3 columnas */
        gap: 12px;
        margin-bottom: 20px;
    }

    /* Botones del teclado numérico */
    .key {
        padding: 15px 0;
        font-size: 1.5rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.1s;
        font-weight: bold;
    }
    .key:active {
        background: var(--color-primario);
        color: #000;
        transform: scale(0.95);
    }

    /* Botón de borrar (C) y retroceso (<) */
    .key-action {
        background: rgba(255, 77, 77, 0.2);
        border-color: rgba(255, 77, 77, 0.4);
    }
    .key-action:active {
        background: var(--color-error);
    }

    /* Botón Principal (VALIDAR) */
    .btn-main {
        width: 100%;
        padding: 15px;
        font-size: 1.3rem;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        background: var(--color-primario);
        color: var(--color-fondo);
        font-weight: bold;
        box-shadow: 0 0 15px rgba(92, 169, 255, 0.4);
        transition: 0.2s;
        text-transform: uppercase;
        letter-spacing: 2px;
    }
    .btn-main:active {
        transform: scale(0.98);
    }

    /* PANTALLAS FINALES */
    #final h1 {
        font-size: 2.8rem;
        color: var(--color-exito);
        text-shadow: 0 0 20px var(--color-exito);
    }
    #incorrecto h1 {
        font-size: 2.2rem;
        color: var(--color-error);
        text-shadow: 0 0 15px var(--color-error);
    }
    
    #main, #final, #incorrecto {
        display: none; /* Se maneja con JS */
        flex-direction: column;
        align-items: center;
        width: 100%;
        animation: fadeIn 0.5s ease-out forwards;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    /* Ajustes para móviles muy pequeños */
    @media (max-width: 380px) {
        .container { padding: 15px; }
        input { font-size: 2rem; letter-spacing: 8px; }
        .key { padding: 12px 0; font-size: 1.3rem; }
    }

</style>
</head>

<body>

<div class="container">
    
    <div id="main">
        <h1>SISTEMA DE SEGURIDAD</h1>
        <input id="codigo" type="text" placeholder="_____" readonly>
        
        <div class="keypad">
            <button class="key">1</button>
            <button class="key">2</button>
            <button class="key">3</button>
            <button class="key">4</button>
            <button class="key">5</button>
            <button class="key">6</button>
            <button class="key">7</button>
            <button class="key">8</button>
            <button class="key">9</button>
            <button class="key key-action" id="btnBorrarTodo">C</button>
            <button class="key">0</button>
            <button class="key key-action" id="btnBorrarUno">⌫</button>
        </div>

        <button class="btn-main" id="validarBtn">VALIDAR CÓDIGO</button>
    </div>

    <div id="final">
        <h1>¡HAS LOGRADO ESCAPAR!</h1>
        <button class="btn-main" style="background: var(--color-exito);" id="reiniciarBtn">REINICIAR SISTEMA</button>
    </div>

    <div id="incorrecto">
        <h1>ACCESO DENEGADO</h1>
        <p>El código introducido no es correcto.</p>
        <button class="btn-main" style="background: var(--color-error); color: white;" id="reintentarBtn">REINTENTAR</button>
    </div>

</div>

<script>
const codigoCorrecto = "70317";

// Inicialización
document.getElementById("main").style.display = "flex";

// FIX Altura iOS
const setAppHeight = () => {
    document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
}
setAppHeight();
window.addEventListener('resize', setAppHeight);

// --- LÓGICA DEL TECLADO ---
const input = document.getElementById("codigo");

function agregarNumero(num) {
    if (input.value.length < 5) { // Límite de 5 dígitos
        input.value += num;
    }
}

function borrarTodo() {
    input.value = "";
}

function borrarUno() {
    input.value = input.value.slice(0, -1);
}

// Asignar eventos a las teclas numéricas (0-9)
document.querySelectorAll('.key').forEach(boton => {
    // Si es un número (no tiene ID especial)
    if (!boton.id) {
        const numero = boton.innerText;
        
        // Click normal
        boton.addEventListener('click', () => agregarNumero(numero));
        
        // Touchend para iOS (respuesta rápida)
        boton.addEventListener('touchend', (e) => {
            e.preventDefault();
            agregarNumero(numero);
        });
    }
});

// Botones de borrar del teclado
const btnC = document.getElementById("btnBorrarTodo");
const btnBack = document.getElementById("btnBorrarUno");

// Eventos borrar
btnC.addEventListener('click', borrarTodo);
btnC.addEventListener('touchend', (e) => { e.preventDefault(); borrarTodo(); });

btnBack.addEventListener('click', borrarUno);
btnBack.addEventListener('touchend', (e) => { e.preventDefault(); borrarUno(); });


// --- LÓGICA DE VALIDACIÓN ---
function verificar() {
    const val = input.value;
    if (val === codigoCorrecto) {
        cambiarPantalla("final");
    } else {
        cambiarPantalla("incorrecto");
    }
}

function reiniciar() {
    input.value = "";
    cambiarPantalla("main");
}

function reintentar() {
    input.value = "";
    cambiarPantalla("main");
}

function cambiarPantalla(idMostrar) {
    document.getElementById("main").style.display = "none";
    document.getElementById("final").style.display = "none";
    document.getElementById("incorrecto").style.display = "none";
    document.getElementById(idMostrar).style.display = "flex";
}

// Asignar eventos a los botones principales (Validar, Reiniciar, Reintentar)
const validarBtn = document.getElementById("validarBtn");
const reiniciarBtn = document.getElementById("reiniciarBtn");
const reintentarBtn = document.getElementById("reintentarBtn");

// Click
validarBtn.addEventListener('click', verificar);
reiniciarBtn.addEventListener('click', reiniciar);
reintentarBtn.addEventListener('click', reintentar);

// Touchend (iOS Fix)
validarBtn.addEventListener('touchend', (e) => { e.preventDefault(); verificar(); });
reiniciarBtn.addEventListener('touchend', (e) => { e.preventDefault(); reiniciar(); });
reintentarBtn.addEventListener('touchend', (e) => { e.preventDefault(); reintentar(); });

</script>

</body>
</html>
